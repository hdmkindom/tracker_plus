# 版本说明  

本版本 是 用的 rv 24 开源 ,下位机保持 UL 状态,不需要做任何改变  

## 修改内容  

#### 弹道解算

增加了buff弹道解算部分,在 rv 24 example文件里面的解算c文件基础上修改的  

增加了单方向无空气阻力弹道模型,将fly_time 替换为 ftime 

ftime 为上一次解算飞行时间值,去掉了以前写的狗屎无空气阻力模型

弹道解算单独作为一个包

#### 串口修改以及interfces修改

串口部分修改了 两个发包与一个收包  

增加了buff_interfaces 里面的 BuffSend.msg 以及 速度.msg  

#### 加速度模型

修改原来 EKF 模型中 yaw : 由 匀速模型即速度为定值的模型 修改为 加加速度模型即加加速度为定值的模型

+ 貌似还是应该修改成加速度模型,加加速度模型对噪声过于敏感而且模型收敛速度太慢

已经修改为加速度模型,加加速度模型一开始理解错了


#### 自适应噪声

对 过程噪声协方差矩阵 $u_{q}$ 尝试使用创新向量自适应噪声

原来的自适应噪声是简单的 $xyz$ 与 $yaw$ 近似反函数

将 $xyz$ 与 $yaw$ 分别用两个创新向量

待研究,目前看来良好

```cpp
Eigen::VectorXd innovation_xyz = innovation.segment(0, 6); // 提取索引 [0, 1, 2, 3, 4, 5]

// 提取旋转部分 (yaw)

Eigen::VectorXd innovation_yaw = innovation.segment(6, 3); // 提取索引 [6, 7, 8]
```

其中 `innovation` 是 `x_pri - x_post` 在 EKF 预测部分更新

EKF 更新部分,我没有对 观测矩阵做自适应噪声,感觉没有必要,rm观测没有对模型产生影响

所以观测阵噪声可以非常低


#### marker 

现在 被观测的那块装甲板是绿色的,其他还是红色

#### sh 脚本

正则表达式获取 ACM 与 USB 设备

#### 误差测量

新节点测量 识别器,预测器,解算器中的时间,使用一个 header ,求和得到的就是 上位机总误差,将其放到解算器部分,大概可以减少因为曝光导致的延迟误差

#### 录包器

录包器独立,不需要下位机

## 新功能   

- [] interfaces 合并  

- [] 收包增加一个 bool 表示切换打armor还是buff  

- [] 收包增加一个 bool 表示录包器 "start" 还是 "stop"  

- [] 去掉 发包 与 收包 里面无意义的 xyz  

- [] 三种模式, 识别器直连解算器;预测器直连解算器;打符直连解算器; 

# 重要的 需要测量那些值

发弹延迟 : 操作手按下按键,到枪口发出子弹时间
镜头内参


